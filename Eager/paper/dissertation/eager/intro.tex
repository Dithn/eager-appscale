In this chapter we discuss implementing scalable, automated API governance
for cloud-hosted web applications, via the method of policy enforcement.
A lack of API governance can lead to many problems including security breaches, 
poor code reuse, violation of service-level objectives (SLOs), 
naming and branding issues, and abuse of digital 
assets by the API consumers. Unfortunately, most existing cloud platforms
within which web APIs are hosted provide only minimal governance support; 
{\em e.g.} authentication and authorization.  These features
are important to policy implementation since governance often requires
enforcement of access control on APIs.  
However, developers are still responsible for implementing governance policies
that combine features such as API versioning, 
dependency management, and SLO enforcement as part of their respective
applications.  

Moreover, today's cloud platform require that each application
implement its own governance. There is no common, built-in system that enables
cloud administrators to specify policies, which are automatically enforced on 
applications and their APIs.
As a result, the developers must be concerned with development issues (correct
and efficient programming of application logic), as well as governance issues 
(administrative control and management) when implementing applications for the cloud.

Existing API management solutions~\cite{3scale,apigee,layer7} are typically available as
external stand-alone services that are not integrated with the cloud. They do attempt to
address governance concerns beyond mere access control. However, because they
are not integrated within the cloud platform, their function is
advisory and documentarian.  That is, they 
do not possess the ability to implement full enforcement, and instead, alert
operators to potential issues without preventing non-compliant behavior.
They are also costly, and they can fail independently of the cloud, thereby affecting 
the scalability and availability of the software that they govern.
Finally, it is not possible for them to
implement governance at deployment-time -- the phase of the software lifecycle
during which an API change or a new API is being put into service.
Because of the scale at which clouds operate, deployment-time governance is
critical since it permits policy violations to be remediated before the
changes are put into production ({\em i.e.} before run-time).

Thus, our thesis is that governance must be implemented as a built-in, native
cloud service to overcome these shortcomings.
That is, instead of an API management
approach that layers governance features on top of the cloud, 
we propose to provide API governance as a fundamental service of the cloud
platform.  Cloud-native governance capabilities
\begin{itemize}
\item enable both deployment-time and run-time enforcement of governance
policies as part of the cloud platform's core functionality,
\item avoid inconsistencies and failure modes caused  
by integration and configuration of governance services that are not
end-to-end integrated within the cloud fabric itself, 
\item leverage already-present cloud functionality such as fault tolerance,
high availability and elasticity to facilitate governance, and
\item unify a vast diversity of API
governance features across all stages of the API lifecycle
(development, deployment, deprecation, retirement). 
\end{itemize}
As a cloud-native functionality, such an
approach also simplifies and automates the enforcement of API governance in the cloud.
This in turns enables separation of governance concerns from development concerns
for both cloud administrators as well as cloud application developers. The cloud
administrators simply specify the policies, and trust the cloud
platform to enforce them automatically on the applications. The application developers
do not have to program any governance features into their applications, and instead
rely on the cloud platform to perform the necessary governance checks either
when the application is uploaded to the cloud, or when the application is being 
executed.

To explore the efficacy of cloud-integrated API governance, we have developed
an experimental cloud platform that supports governance policy specification,
and enforcement for the applications it hosts. 
EAGER -- {\bf E}nforced {\bf A}PI {\bf G}overnance
{\bf E}ngine for {\bf R}EST -- is a model and an architecture that is designed
to be integrated within existing
cloud platforms in order to facilitate API governance as a 
cloud-native feature. EAGER enforces proper versioning of APIs and supports dependency 
management and comprehensive policy enforcement at API deployment-time. 

Using EAGER, we investigate the trade-offs between deployment-time policy
enforcement and run-time policy enforcement.
Deployment-time enforcement is attractive for several
reasons.  First, if run-time only API governance is implemented, 
policy violations will go undetected until the offending APIs are used,
possibly in a deep stack or call path in an application.  
As a result, it may be difficult or time consuming to pinpoint the specific
API and policy that are being violated (especially in a heavily loaded web service).
In these settings, multiple deployments and rollbacks may occur before a policy
violation is triggered making it difficult or impossible to determine the root
cause of the violation.  By enforcing governance as much as possible
at deployment-time,
EAGER implements ``fail fast'' in which violations are detected
immediately making diagnosis and remediation less complex.  
Further, from a maintenance perspective,  the overall
system is prevented from entering a non-compliant state, which aids in the
certification of regulatory compliance.  In addition, run-time governance
typically implies that each API call will be intercepted by a policy-checking engine
that uses admission control, and an enforcement mechanism creating scalability
concerns.  Because deployment
events occur before the application is executed,
traffic need not be intercepted and checked ``in flight'', improving the
scaling properties of governed APIs.  However, not all governance policies can be
implemented strictly at deployment-time.  As such, EAGER includes run-time
governance facilities as well.  The goal of our research is to identify how to
implement enforced API governance most efficiently by combining deployment-time  
governance where possible and run-time governance where necessary.

EAGER implements policies governing the APIs that are 
deployed within a single administrative domain (i.e. a single cloud platform). 
It treats APIs as first-class software assets due to the following reasons.
\begin{itemize}
\item APIs are often
longer lived than the individual clients that use them or the implementations
of the services that they represent.
\item APIs represent the
``gateway'' between software functionality consumption 
(API clients and users) and service
production (web service implementation).
\end{itemize}

EAGER acknowledges the crucial role APIs play
 by separating the API life cycle management from that
of the service implementations and the client users.  
It facilitates policy definition and enforcement at
the API level, thereby permitting the service and client implementations to change
independently without the loss of governance control.
EAGER further enhances software maintainability by guaranteeing that 
developers reuse existing APIs when possible to create new software artifacts
(to prevent API redundancy and unverified API use). Concurrently, it
tracks changes made by developers to already deployed web APIs to prevent
any backwards-incompatible API changes from being put into production.

EAGER includes a language for specifying 
API governance policies.  The EAGER language is distinct from 
existing policy languages like WS-Policy~\cite{WSPolicy,soagovstandard}
in that it avoids the complexities of XML, 
and it incorporates a developer-friendly Python programming language syntax for 
specifying complex policy statements in a simple and 
intuitive manner. Moreover, we ensure that specifying the required policies 
is the only additional activity that API providers should perform in
order to use EAGER. All other API governance related verification and 
enforcement work is carried out by the cloud platform automatically.

To evaluate the feasibility and performance of the proposed 
architecture, we prototype the EAGER concepts in an implementation
that extends AppScale~\cite{appscale13}, 
an open source
cloud platform that emulates Google App Engine~\cite{gae}. We describe
the implementation and integration as an investigation of
the generality of the approach.  By focusing on deployment actions and
run-time message checking, we believe that the integration methodology
will translate to other extant cloud platforms.

We further show that 
EAGER API governance and policy enforcement impose a negligible 
overhead on the application deployment process, and the overhead
is linear in the number of APIs in the applications 
being validated.  
Finally, we show that EAGER is able to
scale to tens of thousands of deployed web APIs and hundreds of
governance policies.

In the sections that follow, we present some background on cloud-hosted APIs,
and overview the design and implementation of
EAGER. We then empirically evaluate EAGER using a wide range of APIs and
experiments.  Finally, we discuss related work, and conclude the chapter.