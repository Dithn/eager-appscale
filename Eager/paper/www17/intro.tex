%% complexity and convenience make diagnosing PaaS application performance hard
%% -- PaaS is opaque to programmers
%% -- PaaS services must operate at scale (asynchronous, distributed)
%% new PaaS service for performance diagnotics
%% -- can't require application instrumentation to be a PaaS service
%% -- must be fully automated
%% -- must be integrated with the runtime system 
%% diagnosis => after the fact
%% -- can use asynchronous, but must be able to time correlate
Over the last decade cloud computing has become a popular approach for deploying
applications at scale~\cite{Antonopoulos:2010:CCP:1855007,Pinheiro:2014:ACC:2618168.2618188}. 
Many organizations, academic institutions, and hobbyists make use of public
and/or private clouds to deploy their applications.
This rapid growth in cloud technology has intensified the need 
for new techniques to
monitor applications deployed in cloud platforms~\cite{DaCunhaRodrigues:2016:MCC:2851613.2851619}. 
Application developers and users wish
to monitor the availability of the deployed applications, track application performance, and detect 
application and system anomalies as they occur. To obtain this level of deep operational insight into
cloud-hosted applications, the cloud platforms must be equipped with powerful instrumentation,
data gathering and analysis capabilities that span the entire stack of the cloud. 
However, most cloud technologies available
today either do not provide any application monitoring support, or only provide primitive
monitoring features such as application-level logging. Hence, they are not capable of conducting
performance anomaly detection, which requires much more fine-grained
data collection and analytics across the entire cloud platform.

Further compounding this problem, today's cloud platforms are very 
large and complex~\cite{DaCunhaRodrigues:2016:MCC:2851613.2851619,Ibidunmoye:2015:PAD:2808687.2791120}. They are
comprised of many layers, where each layer may consist of a multitude of interacting components.
Therefore when a performance anomaly manifests in a user application, it is rather challenging 
to determine the exact layer or the component of the cloud platform that may be responsible for it. 
Facilitating this level of comprehensive root cause analysis requires
data collection at different layers of the cloud, and mechanisms for correlating events at
different layers and components. Today's cloud platforms do not support such deeply integrated
data collection. The plethora of existing third party cloud monitoring solutions
do not have visibility into the low-level activities of the cloud thereby rendering them incapable
of performing systemwide root cause analysis.

Moreover, performance monitoring for cloud applications needs to be highly customizable. Different
applications have different monitoring requirements in terms of data gathering frequency (sampling rate), 
length of the history to consider when performing statistical analysis, and the performance 
SLOs (service level objectives) to maintain over time and check for violations. Cloud monitoring
should be able to facilitate these diverse requirements at the granularity of the applications, and
their client-facing APIs.
Designing such customizable and extensible performance
monitoring frameworks that are built into the cloud platforms is a novel and challenging undertaking.

To address these needs, we present the design of 
a comprehensive application platform 
monitor (APM) called Roots that can be easily built into a wide variety of cloud Platform-as-a-Service 
(PaaS) technologies. The proposed
APM is not an external system that monitors a cloud platform from the outside (as most APM systems today). 
Rather, it integrates with
the PaaS cloud from within thereby extending and augmenting the existing components of the PaaS cloud
to provide comprehensive full stack monitoring and analytics. 
We believe that this design decision is a key differentiator over existing cloud 
application monitoring systems because (i) it is
able to take advantage of the scaling, efficiency, deployment, fault tolerance, security, 
and control features that the underlying cloud offers, 
(ii) while providing low overhead end-to-end monitoring of cloud applications.

Previous work has outlined several key requirements that need to be taken into consideration when
designing a cloud monitoring system~\cite{DaCunhaRodrigues:2016:MCC:2851613.2851619,Ibidunmoye:2015:PAD:2808687.2791120}. 
These include scalability, autonomy and dynamic resource management. We strive to incorporate
these features into our design as much as possible.
Roots is also customizable so that different monitoring policies can be
configured at the application and web API level. It facilitates a number of statistical analysis
methods for anomaly detection and root cause analysis. New analysis methods
can be easily brought into the framework by building on the high-level abstractions
that Roots provides. This enables us to experiment with different combinations of
statistical methods to determine which analysis works best for a given application or
SLO scenario. 

Roots collects most of the data it requires by instrumenting 
various components of the cloud platform. In addition to high-level metrics like request throughput
and request latency, Roots also records the internal PaaS services invoked by user applications,
and the latency of those internal service calls. However, Roots takes special care to keep the data
collection overhead to a minimum. Specifically, it does not instrument any user code (i.e. applications)
deployed in the cloud. It also does not impose any restrictions on the user code.
That is, the developer does not have to write code using some Roots-specific API or link their
code with a Roots-specific library.

When Roots detects a performance anomaly in an application, it attempts to uncover the
root cause of the anomaly by analyzing the workload data,
and the performance of the internal PaaS cloud services the application depends on. 
This way Roots can determine if the detected anomaly was caused by a change in the
application workload (e.g. a sudden spike in the number of client requests), or an internal
bottleneck in the cloud platform (e.g. a slow database query). To this end we also propose
a statistical method that uses a combination of quantile analysis, change point detection
and linear regression to perform root cause analysis. We demonstrate that this approach is
capable of detecting the root causes of performance anomalies with nearly 100\% accuracy. 

Roots uses batch operations and asynchronous 
communication to record events in a manner that does not introduce
delays to the application request processing activities of the 
cloud. 
Additionally, Roots employs a collection of lightweight continuous application benchmarking
processes to collect performance data regarding user applications. Both
the benchmarking processes, and the data analysis processes are executed 
out of the request processing flow of the cloud platform. Such processes can be
grouped together, and managed by a single deployable entity known as a
``Roots Pod''. Pods are specifically designed to keep minimum state
information regarding the applications they monitor and analyze. This enables
a single pod to monitor a large number of applications. Each pod is self-contained,
and therefore scalability and high availability can be achieved by running multiple pods (sharding),
and running multiple replicas of the same pod.

The following subsections detail the architecture of Roots APM, and how it integrates with a typical PaaS
cloud. We describe individual components of the APM, their functions and how they interact with each
other. Where appropriate, we also detail the concrete technologies (tools and products) that we plan to use to implement
various components of the APM, and provide our rationale and intuition behind choosing these technologies.
